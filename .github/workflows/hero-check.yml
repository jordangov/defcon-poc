name: Hero Check

on:
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          repository: jordangov/defcon-poc
          # token needss to be able read repo contents, write to PRs, and read secrets
          token: ${{secrets.GH_TOKEN}}
          fetch-depth: 0
      - name: Run script
        run: |
          SUBMISSION=`git checkout HEAD > /dev/null && git diff main | awk '/\* @${{github.actor}}/{ print $3 }'`
          CHECKSUM=`echo -n "${{github.actor}}-${{secrets.SALT}}" | openssl dgst -${{secrets.ALGO}}`
          echo "Confirming submission: $SUBMISSION"
          echo "      equals checksum: $CHECKSUM"
